# Enable true color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Fix escape delay (important for TUI responsiveness)
set -sg escape-time 0

# Enable mouse support for scrolling
set -g mouse on

# Enable clipboard via OSC 52 (works through terminal to host clipboard)
set -s set-clipboard on

# Enable clipboard terminal feature for OSC 52 passthrough
set -as terminal-features ',xterm-256color:clipboard'
set -as terminal-features ',screen-256color:clipboard'

# Allow OSC 52 to pass through to outer terminal (for nested tmux/docker)
set -g allow-passthrough on

# Use vi mode for copy operations
setw -g mode-keys vi

# Copy mode bindings (vi-style)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "printf '\\033]52;c;%s\\a' \"$(base64 | tr -d '\\n')\" > /dev/tty"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "printf '\\033]52;c;%s\\a' \"$(base64 | tr -d '\\n')\" > /dev/tty"

# Also handle emacs-style copy mode for completeness
bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "printf '\\033]52;c;%s\\a' \"$(base64 | tr -d '\\n')\" > /dev/tty"

# Enter copy mode with prefix + [
bind [ copy-mode

# Paste with prefix + ]
bind ] paste-buffer

# Increase scrollback buffer
set -g history-limit 50000

# Ensure proper window/pane sizing
setw -g aggressive-resize on
